<!DOCTYPE html>
<meta charset="UTF-8">

<!-- HTML file to host Blockly in a mobile WebView. -->
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style type="text/css">
    html, body, #blocklyDiv {
      border: 0;
      height: 100%;
      margin: 0;
      padding: 0;
      width: 100%;
    }
  </style>
  <script src="blockly_compressed.js"></script>
  <script src="blocks_compressed.js"></script>
  <script src="javascript_compressed.js"></script>
  <script src="python_compressed.js"></script>
  <!-- TODO: Select msg file based on locale. -->
  <script src="msg/js/fa.js"></script>
  <script src="toolbox_standard.js"></script>
</head>
<body>
<!--  TODO: Select msg file based on locale. -->
<p>
   <button onclick="showPython()">Show Python</button>
   <button onclick="showJs()">Show JavaScript</button>
   <button onclick="runJsCode()">Run JavaScript</button>
</p>
<div id="blocklyDiv" style="height: 550px;" ></div>

<script type="text/javascript">
    function showPython() {
      // Generate JavaScript code and display it.
      Blockly.Python.INFINITE_LOOP_TRAP = null;
      var code = Blockly.Python.workspaceToCode(myWorkspace);
      alert(code);
    }

    function showJs() {
      // Generate JavaScript code and display it.
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      var code = Blockly.JavaScript.workspaceToCode(myWorkspace);
      alert(code);
    }

    function runJsCode() {
      // Generate JavaScript code and run it.
      window.LoopTrap = 1000;
      Blockly.JavaScript.INFINITE_LOOP_TRAP =
          'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
      var code = Blockly.JavaScript.workspaceToCode(myWorkspace);
      debugger
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
	  
      try {
        eval(code);
      } catch (e) {
        alert(e);
      }
    }

    

    var myWorkspace = Blockly.inject('blocklyDiv', {
      toolbox: BLOCKLY_TOOLBOX_XML['standard'],
      collapse : true, 
      comments : true, 
      disable : true, 
      maxBlocks : Infinity, 
      trashcan : true, 
      horizontalLayout : false, 
      toolboxPosition : 'start', 
      css : true, 
      rtl : true, 
      scrollbars : true, 
      sounds : true, 
      oneBasedIndex : true, 
      grid : {
        spacing : 20, 
        length : 1, 
        colour : '#888', 
        snap : false
      }, 
      media: 'media/',
      // media : 'https://blockly-demo.appspot.com/static/media/', 
      rtl: true,
      zoom : {
        controls : true, 
        wheel : true, 
        startScale : 1, 
        maxScale : 3, 
        minScale : 0.3, 
        scaleSpeed : 1.2
      }
    });

    myWorkspace.registerButtonCallback("myButtonPressed", runCode)

    function callTts(text){
      Android.tts(text);
    }

    function callStt(){
      var string = "";
      try{
        string = Android.stt();
      }catch(e){
        alert(e);
      }
      return string;
    }


    function runCode(btn) {
      string = "default string";
      string = Android.stt();
      alert(string);
    }
</script>
</body>
</html>