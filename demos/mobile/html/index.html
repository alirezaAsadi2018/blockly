<!DOCTYPE html>
<!-- HTML file to host Blockly in a mobile WebView. -->
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<title>Speech to text conversion using JavaScript</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href="https://fonts.googleapis.com/css?family=Shadows+Into+Light" rel="stylesheet">
	<style type="text/css">
	html, body, #blocklyDiv {
	  border: 0;
	  height: 100%;
	  margin: 0;
	  padding: 0;
	  width: 100%;
	}
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="blockly_compressed.js"></script>
	<script src="blocks_compressed.js"></script>
	<!-- TODO: Select msg file based on locale. -->
	<script src="msg/js/fa.js"></script>
	<script src="toolbox_standard.js"></script>
	</head>
	<body>
	<div id="blocklyDiv"></div>
	<script type="application/javascript"> 
	var workspacePlayground = Blockly.inject('blocklyDiv', {
			media: 'media/',
			rtl: true,
			toolbox: BLOCKLY_TOOLBOX_XML['standard'],
			zoom: {controls: true}
		});
	workspacePlayground.registerButtonCallback("myButtonPressed", runCode);
	

	var recognition;
	var Content = '';
	initSpeechRecognizer()

	function initSpeechRecognizer(){
		var SpeechRecognition = window.webkitSpeechRecognition;
		SpeechRecognition.lang = 'en-US';
		recognition = new SpeechRecognition();
		recognition.continuous = false;
		
		recognition.onresult = function(event) {
			var current = event.resultIndex;
			var transcript = event.results[current][0].transcript;
			Content += transcript;
			alert(Content);
		};

		recognition.onstart = function() { 
			alert('started')
			Content = '';
		}

		recognition.onspeechend = function() {
			alert('ended')
		}

		recognition.onerror = function(event) {
			if(event.error == 'no-speech') {
				alert('Try again.')
			}else{
				alert(event.error)
				console.log(event)
			}
		}
		if (Content.length) {
			Content += ' ';
		}
	}

	function runCode(btn) {
		// recognition.stop()
		recognition.start();
	}
	</script>
</body>
</html>
